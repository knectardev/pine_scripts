// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Your Name

//@version=5
strategy("EMA Crossover Strategy", 
  overlay = true,
  defaultQtyType = strategy.percent_of_equity,
  defaultQtyValue = 10,
  initialCapital = 10000,
  commissionType = strategy.commission.percent,
  commissionValue = 0.1)

// ============================================================================
// DESCRIPTION
// ============================================================================
// Simple exponential moving average crossover strategy. Generates buy signals
// when the fast EMA crosses above the slow EMA, and sell signals when the
// fast EMA crosses below the slow EMA.
//
// AUTHOR: Your Name
// Version: v1.1.1
// DATE: 2026-01-08
//
// PARAMETERS:
// - fastLengthInput: Period for the fast EMA (default: 9)
// - slowLengthInput: Period for the slow EMA (default: 21)
//
// USAGE:
// Works best in trending markets on 4H or daily timeframes.
// Consider adding filters for ranging conditions.
// ============================================================================

// ————— Constants
const color FAST_EMA_COLOR      = #0000FFff
const color SLOW_EMA_COLOR      = #FF8000ff
const color BUY_SIGNAL_COLOR    = #00FF00ff
const color SELL_SIGNAL_COLOR   = #FF0000ff
const color BG_UPTREND          = color.new(#00FF00ff, 95)
const color BG_DOWNTREND        = color.new(#FF0000ff, 95)

const int   DEFAULT_FAST_LENGTH = 9
const int   DEFAULT_SLOW_LENGTH = 21

const string ENTRY_ID           = "Long"

// ————— Inputs
int fastLengthInput = input.int(DEFAULT_FAST_LENGTH, "Fast EMA Length", minval = 1)
int slowLengthInput = input.int(DEFAULT_SLOW_LENGTH, "Slow EMA Length", minval = 1)

// ————— Calculations
// Calculate EMAs
float emaFast = ta.ema(close, fastLengthInput)
float emaSlow = ta.ema(close, slowLengthInput)

// Generate Signals - Only after sufficient data
bool sufficientData = bar_index >= math.max(fastLengthInput, slowLengthInput)

bool longCondition = sufficientData and ta.crossover(emaFast, emaSlow)
bool shortCondition = sufficientData and ta.crossunder(emaFast, emaSlow)

// Determine trend
bool isUptrend = emaFast > emaSlow

// ————— Strategy Calls
if longCondition
  strategy.entry(ENTRY_ID, strategy.long)

if shortCondition
  strategy.close(ENTRY_ID)

// ————— Visuals
// Plot EMAs
plot(emaFast, "Fast EMA", 
  color = color.new(FAST_EMA_COLOR, 0), 
  linewidth = 2)
plot(emaSlow, "Slow EMA", 
  color = color.new(SLOW_EMA_COLOR, 0), 
  linewidth = 2)

// Visual Signals
plotshape(longCondition, "Buy Signal", 
  shape.triangleup, 
  location.belowbar, 
  color = color.new(BUY_SIGNAL_COLOR, 0), 
  size = size.small)

plotshape(shortCondition, "Sell Signal", 
  shape.triangledown, 
  location.abovebar, 
  color = color.new(SELL_SIGNAL_COLOR, 0), 
  size = size.small)

// Background coloring for trend
bgcolor(isUptrend ? BG_UPTREND : BG_DOWNTREND)
